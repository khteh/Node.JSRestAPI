var cov_1m62snpqfl=function(){var path="C:\\Projects\\Node.js\\Node.JSRestAPI\\BusinessLogic\\suspend.js";var hash="e17469c1420b6c71f04f338ac0593ce58eb4b43e";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Projects\\Node.js\\Node.JSRestAPI\\BusinessLogic\\suspend.js",statementMap:{"0":{start:{line:1,column:14},end:{line:1,column:32}},"1":{start:{line:2,column:21},end:{line:2,column:47}},"2":{start:{line:3,column:13},end:{line:3,column:29}},"3":{start:{line:4,column:9},end:{line:4,column:32}},"4":{start:{line:5,column:12},end:{line:5,column:28}},"5":{start:{line:7,column:20},end:{line:7,column:22}},"6":{start:{line:8,column:4},end:{line:8,column:70}},"7":{start:{line:9,column:1},end:{line:67,column:2}},"8":{start:{line:10,column:2},end:{line:56,column:5}},"9":{start:{line:12,column:27},end:{line:12,column:88}},"10":{start:{line:13,column:7},end:{line:23,column:10}},"11":{start:{line:14,column:11},end:{line:21,column:69}},"12":{start:{line:15,column:15},end:{line:15,column:65}},"13":{start:{line:16,column:16},end:{line:21,column:69}},"14":{start:{line:17,column:15},end:{line:17,column:40}},"15":{start:{line:21,column:15},end:{line:21,column:69}},"16":{start:{line:22,column:11},end:{line:22,column:35}},"17":{start:{line:25,column:7},end:{line:25,column:43}},"18":{start:{line:26,column:7},end:{line:42,column:32}},"19":{start:{line:27,column:31},end:{line:27,column:92}},"20":{start:{line:29,column:28},end:{line:40,column:13}},"21":{start:{line:30,column:15},end:{line:38,column:16}},"22":{start:{line:31,column:19},end:{line:31,column:48}},"23":{start:{line:34,column:19},end:{line:37,column:103}},"24":{start:{line:35,column:23},end:{line:35,column:110}},"25":{start:{line:37,column:23},end:{line:37,column:103}},"26":{start:{line:39,column:15},end:{line:39,column:39}},"27":{start:{line:42,column:11},end:{line:42,column:32}},"28":{start:{line:45,column:12},end:{line:55,column:13}},"29":{start:{line:46,column:16},end:{line:46,column:63}},"30":{start:{line:47,column:16},end:{line:47,column:46}},"31":{start:{line:48,column:16},end:{line:48,column:53}},"32":{start:{line:54,column:16},end:{line:54,column:38}},"33":{start:{line:58,column:5},end:{line:58,column:21}},"34":{start:{line:59,column:5},end:{line:66,column:104}},"35":{start:{line:60,column:9},end:{line:60,column:85}},"36":{start:{line:61,column:10},end:{line:66,column:104}},"37":{start:{line:62,column:9},end:{line:62,column:85}},"38":{start:{line:63,column:10},end:{line:66,column:104}},"39":{start:{line:64,column:9},end:{line:64,column:85}},"40":{start:{line:66,column:9},end:{line:66,column:104}},"41":{start:{line:69,column:0},end:{line:69,column:25}}},fnMap:{"0":{name:"Suspend",decl:{start:{line:6,column:9},end:{line:6,column:16}},loc:{start:{line:6,column:33},end:{line:68,column:1}},line:6},"1":{name:"(anonymous_1)",decl:{start:{line:11,column:3},end:{line:11,column:4}},loc:{start:{line:11,column:23},end:{line:24,column:4}},line:11},"2":{name:"(anonymous_2)",decl:{start:{line:13,column:31},end:{line:13,column:32}},loc:{start:{line:13,column:56},end:{line:23,column:8}},line:13},"3":{name:"(anonymous_3)",decl:{start:{line:24,column:6},end:{line:24,column:7}},loc:{start:{line:24,column:26},end:{line:43,column:4}},line:24},"4":{name:"(anonymous_4)",decl:{start:{line:29,column:52},end:{line:29,column:53}},loc:{start:{line:29,column:77},end:{line:40,column:12}},line:29},"5":{name:"(anonymous_5)",decl:{start:{line:44,column:5},end:{line:44,column:6}},loc:{start:{line:44,column:28},end:{line:56,column:3}},line:44}},branchMap:{"0":{loc:{start:{line:9,column:1},end:{line:67,column:2}},type:"if",locations:[{start:{line:9,column:1},end:{line:67,column:2}},{start:{line:9,column:1},end:{line:67,column:2}}],line:9},"1":{loc:{start:{line:9,column:5},end:{line:9,column:121}},type:"binary-expr",locations:[{start:{line:9,column:5},end:{line:9,column:35}},{start:{line:9,column:39},end:{line:9,column:76}},{start:{line:9,column:80},end:{line:9,column:121}}],line:9},"2":{loc:{start:{line:14,column:11},end:{line:21,column:69}},type:"if",locations:[{start:{line:14,column:11},end:{line:21,column:69}},{start:{line:14,column:11},end:{line:21,column:69}}],line:14},"3":{loc:{start:{line:16,column:16},end:{line:21,column:69}},type:"if",locations:[{start:{line:16,column:16},end:{line:21,column:69}},{start:{line:16,column:16},end:{line:21,column:69}}],line:16},"4":{loc:{start:{line:26,column:7},end:{line:42,column:32}},type:"if",locations:[{start:{line:26,column:7},end:{line:42,column:32}},{start:{line:26,column:7},end:{line:42,column:32}}],line:26},"5":{loc:{start:{line:30,column:15},end:{line:38,column:16}},type:"if",locations:[{start:{line:30,column:15},end:{line:38,column:16}},{start:{line:30,column:15},end:{line:38,column:16}}],line:30},"6":{loc:{start:{line:34,column:19},end:{line:37,column:103}},type:"if",locations:[{start:{line:34,column:19},end:{line:37,column:103}},{start:{line:34,column:19},end:{line:37,column:103}}],line:34},"7":{loc:{start:{line:45,column:12},end:{line:55,column:13}},type:"if",locations:[{start:{line:45,column:12},end:{line:55,column:13}},{start:{line:45,column:12},end:{line:55,column:13}}],line:45},"8":{loc:{start:{line:47,column:27},end:{line:47,column:44}},type:"binary-expr",locations:[{start:{line:47,column:27},end:{line:47,column:37}},{start:{line:47,column:41},end:{line:47,column:44}}],line:47},"9":{loc:{start:{line:59,column:5},end:{line:66,column:104}},type:"if",locations:[{start:{line:59,column:5},end:{line:66,column:104}},{start:{line:59,column:5},end:{line:66,column:104}}],line:59},"10":{loc:{start:{line:59,column:9},end:{line:59,column:109}},type:"binary-expr",locations:[{start:{line:59,column:9},end:{line:59,column:36}},{start:{line:59,column:40},end:{line:59,column:75}},{start:{line:59,column:79},end:{line:59,column:109}}],line:59},"11":{loc:{start:{line:61,column:10},end:{line:66,column:104}},type:"if",locations:[{start:{line:61,column:10},end:{line:66,column:104}},{start:{line:61,column:10},end:{line:66,column:104}}],line:61},"12":{loc:{start:{line:63,column:10},end:{line:66,column:104}},type:"if",locations:[{start:{line:63,column:10},end:{line:66,column:104}},{start:{line:63,column:10},end:{line:66,column:104}}],line:63}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0},b:{"0":[0,0],"1":[0,0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0,0],"11":[0,0],"12":[0,0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184",hash:"e17469c1420b6c71f04f338ac0593ce58eb4b43e"};var coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}return coverage[path]=coverageData;}();var express=(cov_1m62snpqfl.s[0]++,require('express'));var emailvalidator=(cov_1m62snpqfl.s[1]++,require('email-validator'));var router=(cov_1m62snpqfl.s[2]++,express.Router());var db=(cov_1m62snpqfl.s[3]++,require('../lib/db.js'));var async=(cov_1m62snpqfl.s[4]++,require('async'));function Suspend(req,res,next){cov_1m62snpqfl.f[0]++;var studentID=(cov_1m62snpqfl.s[5]++,-1);cov_1m62snpqfl.s[6]++;console.log("POST /api/suspend req: "+JSON.stringify(req.body));cov_1m62snpqfl.s[7]++;if((cov_1m62snpqfl.b[1][0]++,req.body.student!==undefined)&&(cov_1m62snpqfl.b[1][1]++,typeof req.body.student==='string')&&(cov_1m62snpqfl.b[1][2]++,emailvalidator.validate(req.body.student))){cov_1m62snpqfl.b[0][0]++;cov_1m62snpqfl.s[8]++;async.series([function(callback){cov_1m62snpqfl.f[1]++;var teacher_query=(cov_1m62snpqfl.s[9]++,`select id from students where email = '${req.body.student}'`);cov_1m62snpqfl.s[10]++;db.query(teacher_query,function(error,result){cov_1m62snpqfl.f[2]++;cov_1m62snpqfl.s[11]++;if(error){cov_1m62snpqfl.b[2][0]++;cov_1m62snpqfl.s[12]++;console.error(`Database error: ${error.message}`);}else{cov_1m62snpqfl.b[2][1]++;cov_1m62snpqfl.s[13]++;if(result.length>0){cov_1m62snpqfl.b[3][0]++;cov_1m62snpqfl.s[14]++;studentID=result[0].id;//console.log(`Get student: ${studentID}`);
//console.log('rows: '+rows+);
}else{cov_1m62snpqfl.b[3][1]++;cov_1m62snpqfl.s[15]++;console.log(`Student ${req.body.student} not found!`);}}cov_1m62snpqfl.s[16]++;callback(error,result);});},function(callback){cov_1m62snpqfl.f[3]++;cov_1m62snpqfl.s[17]++;console.log("studentID "+studentID);cov_1m62snpqfl.s[18]++;if(studentID!==-1){cov_1m62snpqfl.b[4][0]++;var student_query=(cov_1m62snpqfl.s[19]++,`UPDATE students SET isSuspended = 1 WHERE id='${studentID}'`);//console.log("UPDATE statement: " + student_query);
var newTeacher=(cov_1m62snpqfl.s[20]++,db.query(student_query,function(error,result){cov_1m62snpqfl.f[4]++;cov_1m62snpqfl.s[21]++;if(error){cov_1m62snpqfl.b[5][0]++;cov_1m62snpqfl.s[22]++;console.error(error.message);}// if error occured during connection 
else{cov_1m62snpqfl.b[5][1]++;cov_1m62snpqfl.s[23]++;// rows: {"fieldCount":0,"affectedRows":1,"insertId":2,"serverStatus":2,"warningCount":0,"message":"","protocol41":true,"changedRows":0}
if(result.affectedRows===1){cov_1m62snpqfl.b[6][0]++;cov_1m62snpqfl.s[24]++;console.log('Student '+req.body.student+' suspended successfully. ID: '+studentID);}else{cov_1m62snpqfl.b[6][1]++;cov_1m62snpqfl.s[25]++;console.error(`Failed to suspend student ${req.body.student} ID: ${studentID}`);}}cov_1m62snpqfl.s[26]++;callback(error,result);}));}else{cov_1m62snpqfl.b[4][1]++;cov_1m62snpqfl.s[27]++;callback(null,null);}}],function(err,results){cov_1m62snpqfl.f[5]++;cov_1m62snpqfl.s[28]++;if(err){cov_1m62snpqfl.b[7][0]++;cov_1m62snpqfl.s[29]++;console.error("Error: "+JSON.stringify(err));cov_1m62snpqfl.s[30]++;res.status((cov_1m62snpqfl.b[8][0]++,err.status)||(cov_1m62snpqfl.b[8][1]++,500));cov_1m62snpqfl.s[31]++;res.json({'message':err.message});}else{cov_1m62snpqfl.b[7][1]++;cov_1m62snpqfl.s[32]++;// Index of results:
// 0: result from the first serial function
// 1: results from the second serial function
//console.log("register result: " + JSON.stringify(results));
res.status(204).end();}});}else{cov_1m62snpqfl.b[0][1]++;cov_1m62snpqfl.s[33]++;res.status(400);cov_1m62snpqfl.s[34]++;if((cov_1m62snpqfl.b[10][0]++,!req.hasOwnProperty('body'))||(cov_1m62snpqfl.b[10][1]++,!req.body.hasOwnProperty('student'))||(cov_1m62snpqfl.b[10][2]++,req.body.student===undefined)){cov_1m62snpqfl.b[9][0]++;cov_1m62snpqfl.s[35]++;res.json({'message':'Calling /api/suspend without specifying student!'});}else{cov_1m62snpqfl.b[9][1]++;cov_1m62snpqfl.s[36]++;if(typeof req.body.student!=='string'){cov_1m62snpqfl.b[11][0]++;cov_1m62snpqfl.s[37]++;res.json({'message':'Calling /api/suspend with more than one student!'});}else{cov_1m62snpqfl.b[11][1]++;cov_1m62snpqfl.s[38]++;if(!emailvalidator.validate(req.body.student)){cov_1m62snpqfl.b[12][0]++;cov_1m62snpqfl.s[39]++;res.json({'message':'Calling /api/suspend with invalid student email!'});}else{cov_1m62snpqfl.b[12][1]++;cov_1m62snpqfl.s[40]++;res.json({'message':`Calling /api/suspend with unregistered student ${req.body.student}!`});}}}}};cov_1m62snpqfl.s[41]++;module.exports=Suspend;